
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Battery Recycle Bin – Demo</title>
  <style>
    :root{
      --bg: #f6fbff;
      --surface: #ffffff;
      --text: #0d1b2a;
      --muted: #54728c;
      --green: #27ae60;
      --blue: #2d9cdb;
      --red: #e74c3c;
      --glow: 0 10px 30px rgba(45,156,219,0.25);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background: linear-gradient(180deg, #eff9ff 0%, #f7fffb 100%);
    }
    .app{
      min-height:100%;
      display:grid;
      grid-template-rows:auto 1fr auto;
    }
    /* Header */
    header{
      display:flex;align-items:center;gap:12px;
      padding:16px 20px; 
    }
    .logo{
      width:40px;height:40px;border-radius:12px;
      background: radial-gradient(circle at 30% 30%, #9be7ff, #7fd3ff 40%, #7fffd6 100%);
      position:relative; box-shadow:var(--glow);
    }
    /* battery-bin glyph */
    .logo svg{position:absolute; inset:0; width:100%; height:100%;}
    .brand{font-weight:700;letter-spacing:.2px}
    .counter{margin-left:auto; font-weight:600; background:#fff; padding:8px 12px; border-radius:999px; box-shadow:var(--glow); color:#1673a6}

    /* Canvas card */
    .card{
      width:min(900px, 92vw);
      margin:24px auto 48px;
      background:var(--surface);
      border-radius:var(--radius);
      box-shadow:0 10px 30px rgba(13,27,42,0.08);
      padding:28px; position:relative; overflow:hidden;
    }
    /* Accent aura */
    .card::after{
      content:""; position:absolute; inset:-40% -20% auto auto; height:60%; width:60%;
      background: radial-gradient( circle at 70% 30%, rgba(45,156,219,.12), transparent 60% );
      pointer-events:none;
    }

    /* Screens */
    .screen{display:block}
    .screen[hidden]{display:none !important}
    .screen.active{animation:fadeIn .35s ease}
    @keyframes fadeIn{from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:translateY(0)}}

    .center{display:grid; place-items:center; text-align:center; gap:16px; padding:20px}

    h1{margin:8px 0 0; font-size:clamp(24px, 3.6vw, 36px)}
    p.lead{color:var(--muted); margin:0 0 8px; font-size:clamp(14px, 2.2vw, 18px)}

    .big-btn{
      font-size:clamp(16px, 2.4vw, 22px); font-weight:700;
      padding:18px 28px; border-radius:24px; border:none; cursor:pointer;
      color:#fff;
      background: linear-gradient(135deg, var(--blue), #00c2a8);
      box-shadow: 0 10px 28px rgba(45,156,219,0.35);
      transition: transform .08s ease, filter .2s ease;
    }
    .big-btn:hover{ filter:brightness(1.03)}
    .big-btn:active{ transform:scale(.98)}

    .row{display:flex; flex-wrap:wrap; align-items:center; justify-content:center; gap:18px}
    .ghost-btn{
      background:#e9fbf4; color:#0f7f4c; border:none; padding:12px 18px; border-radius:16px; font-weight:600; cursor:pointer
    }
    .outline-btn{
      background:transparent; border:2px solid #bfe9ff; color:#1673a6; padding:12px 18px; border-radius:16px; font-weight:600; cursor:pointer
    }

    /* Modal */
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.35); padding:16px; z-index:1000; }
    .modal.open{ display:flex; animation:fadeIn .2s ease }
    .modal .sheet{ background:#fff; width:min(560px, 92vw); border-radius:20px; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,.18) }
    .modal .sheet h3{ margin:0 0 6px }
    .modal .sheet p{ margin:0 0 14px; color:var(--muted) }

    /* Detecting */
    .scan{
      width: 70%; max-width:520px; height:14px; border-radius:999px; background:#e8f5ff; overflow:hidden; box-shadow:inset 0 0 0 2px #cfeaff
    }
    .scan .bar{ height:100%; width:35%; background:linear-gradient(90deg, #6fc8ff, #00c2a8); border-radius:999px; animation:slide 1.1s ease-in-out infinite }
    @keyframes slide{ 0%{ transform:translateX(-20%) } 50%{ transform:translateX(120%) } 100%{ transform:translateX(-20%) } }

    .result-icon{ width:80px; height:80px; border-radius:50%; display:grid; place-items:center; margin:10px auto 6px }
    .ok{ background:#e7fbf0; box-shadow:0 0 0 6px #e7fbf0 inset; color:var(--green) }
    .no{ background:#ffeaea; box-shadow:0 0 0 6px #ffeaea inset; color:var(--red) }

    /* Footer */
    footer{ padding:18px; text-align:center; color:#6c8599; font-size:14px }

    .chip{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#eefaff; color:#1673a6; font-weight:600 }
    .scanframe{ width:min(520px, 86vw); height:240px; margin:0 auto 8px; background:#0b0b0b; border-radius:16px; position:relative; box-shadow:inset 0 0 0 4px #0b0b0b, 0 8px 20px rgba(0,0,0,.2) }
    .scanframe::before{ content:""; position:absolute; inset:12px; background:#e9eef2; border-radius:10px }
    .scanner{ position:absolute; left:16px; right:16px; height:3px; top:24px; background:#ff3b30; box-shadow:0 0 10px rgba(255,59,48,.7); border-radius:2px; animation:scanY 1.8s ease-in-out infinite }
    @keyframes scanY{ 0%{ top:24px } 50%{ top:calc(100% - 24px) } 100%{ top:24px } }

    /* IRIS (multi-blade) */
    .irisWrap{ width:260px; height:260px; margin:10px auto; border-radius:50%; background:radial-gradient(circle at 50% 40%, #1a1a2e, #16213e); box-shadow:inset 0 0 0 3px #0f3460, 0 4px 15px rgba(0,0,0,0.3); display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; }
    
    /* Inner container to keep blades centered */
    .irisWrap::before {
      content: "";
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 10;
    }
    
    /* Metallic blade styling */
    .irisWrap .blade {
      position: absolute;
      width: 0;
      height: 0;
      border-left: 40px solid transparent;
      border-right: 40px solid transparent;
      border-bottom: 120px solid #2d3e50;
      transform-origin: 50% calc(100% - 60px);
      transition: all 0.9s cubic-bezier(0.645, 0.045, 0.355, 1);
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
      top: 50%;
      left: 50%;
      margin-left: -40px;
      margin-top: -60px;
    }
    
    /* Metallic gradient effect on blades */
    .irisWrap .blade::before {
      content: "";
      position: absolute;
      left: -40px;
      top: 0;
      width: 80px;
      height: 120px;
      background: linear-gradient(135deg, 
        #4a5568 0%, 
        #2d3748 25%, 
        #1a202c 50%, 
        #2d3748 75%, 
        #4a5568 100%);
      clip-path: polygon(50% 100%, 0% 0%, 100% 0%);
    }
    
    /* Position each blade around the center - CLOSED state */
    .irisWrap .blade:nth-child(1) { transform: rotate(0deg) translateY(0); z-index: 1; }
    .irisWrap .blade:nth-child(2) { transform: rotate(60deg) translateY(0); z-index: 2; }
    .irisWrap .blade:nth-child(3) { transform: rotate(120deg) translateY(0); z-index: 3; }
    .irisWrap .blade:nth-child(4) { transform: rotate(180deg) translateY(0); z-index: 4; }
    .irisWrap .blade:nth-child(5) { transform: rotate(240deg) translateY(0); z-index: 5; }
    .irisWrap .blade:nth-child(6) { transform: rotate(300deg) translateY(0); z-index: 6; }
    
    /* Open state - blades slide outward radially within the frame */
    .irisWrap.open .blade:nth-child(1) { transform: rotate(-5deg) translateY(-90px); }
    .irisWrap.open .blade:nth-child(2) { transform: rotate(55deg) translateY(-90px); }
    .irisWrap.open .blade:nth-child(3) { transform: rotate(115deg) translateY(-90px); }
    .irisWrap.open .blade:nth-child(4) { transform: rotate(175deg) translateY(-90px); }
    .irisWrap.open .blade:nth-child(5) { transform: rotate(235deg) translateY(-90px); }
    .irisWrap.open .blade:nth-child(6) { transform: rotate(295deg) translateY(-90px); }
    
    /* Center hole indicator */
    .irisWrap::after{ 
      content:""; 
      position:absolute; 
      width:100px; 
      height:100px; 
      border-radius:50%; 
      background:radial-gradient(circle, #27ae60 0%, #0ea5a0 70%, transparent 100%); 
      opacity:0; 
      transition:opacity 0.5s ease 0.3s; 
      pointer-events:none; 
      box-shadow:0 0 30px rgba(39, 174, 96, 0.6), inset 0 0 20px rgba(39, 174, 96, 0.3); 
      z-index: 0;
    }
    .irisWrap.open::after{ opacity:0.9; }
    
    /* Hide the SVG iris */
    svg.iris { display: none; }

    .outline-btn.danger{ border:2px solid #ffc8c2; color:#d12a1b; background:#fff5f4; font-weight:700 }
    .outline-btn.danger:hover{ filter:brightness(1.03) }
    .big-btn.danger{ color:#fff; background:linear-gradient(135deg,#ff6b6b,#ff3b30); box-shadow:0 10px 28px rgba(255,59,48,0.35) }
    .big-btn.danger:hover{ filter:brightness(1.03) }

    /* Sensor Display Box */
    .sensor-box {
      width: min(900px, 92vw);
      margin: 0 auto 24px;
      background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
      border-radius: var(--radius);
      box-shadow: 0 4px 15px rgba(13,27,42,0.06);
      padding: 20px 28px;
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
      align-items: center;
      justify-content: space-around;
      border: 2px solid #e0f2fe;
    }
    .sensor-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(45,156,219,0.12);
      min-width: 200px;
    }
    .sensor-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-size: 24px;
    }
    .sensor-icon.temp {
      background: linear-gradient(135deg, #ff6b6b, #ff8e53);
      color: #fff;
    }
    .sensor-icon.distance {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: #fff;
    }
    .sensor-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .sensor-label {
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .sensor-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
      line-height: 1;
      transition: color 0.3s ease;
    }
    .sensor-unit {
      font-size: 16px;
      font-weight: 600;
      color: var(--muted);
      margin-left: 2px;
    }
  </style>
</head>
<body>
  <div class="app" role="application">
    <header>
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 100 100" fill="none" aria-hidden="true">
          <rect x="28" y="25" width="44" height="50" rx="10" fill="#fff" stroke="#0ea5a0" stroke-width="4" />
          <rect x="22" y="22" width="56" height="10" rx="5" fill="#2d9cdb" />
          <rect x="36" y="40" width="28" height="18" rx="4" fill="#2d9cdb" opacity="0.9" />
          <rect x="42" y="46" width="16" height="6" rx="3" fill="#fff" />
        </svg>
      </div>
      <div class="brand">Smart Battery Recycle Bin</div>
      <div class="counter" aria-live="polite">Batteries today: <span id="count">0</span></div>
    </header>

    <main class="card" aria-live="polite">
      <!-- WELCOME -->
      <section id="welcome" class="screen active center" aria-label="Welcome">
        <h1>Welcome!</h1>
        <p class="lead" 
        style="max-width:60ch;
          margin:10px auto 0;
          font-size:18px;
          line-height:1.6;
          color:#2d4a3f;
          text-align:center;">Join our mission to make battery recycling safer and smarter!</p>
        <button class="big-btn" id="startBtn" onclick="openCamera()">Start Recycling</button>
        
        <p class="lead" 
          style="max-width:60ch;
          margin:10px auto 0;
          font-size:16px;
          line-height:1.6;
          text-align:center;">
          Every small action counts — by recycling your batteries properly. <br>
          You help prevent fires, protect our community,
          and keep harmful metals out of the environment.
          </p>
          <p style="text-align:center; color:#0f7f4c; font-size:19px; font-weight:bold;">
            Together, we can power a cleaner future.
          </p>
      </section>

      <!-- DETECTING -->
      <section id="detect" class="screen center" hidden aria-label="Detecting">
        <div class="chip" aria-hidden="true">Scanning</div>
        <h1>Detecting battery type…</h1>
        <div class="scan" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuetext="Scanning">
          <div class="bar"></div>
        </div>
        <p class="lead">Please wait a moment while we identify your battery.</p>
      </section>

      <!-- CHOOSE DETECTED TYPE (manual) -->
      <section id="choose" class="screen center" hidden aria-label="Choose Result">
        <h1>Select detected type</h1>
        <p class="lead">For demo purposes, pick the outcome below.</p>
        <div class="row" style="gap:12px; max-width:780px; margin:auto; flex-direction:column;">
          <button class="big-btn" id="chooseLi" onclick="playIrisSequence('Lithium-based Batteries')">Lithium-based Batteries</button>
          <button class="big-btn" id="chooseAlk" style="background:linear-gradient(135deg,#2d9cdb,#00c2a8)" onclick="playIrisSequence('Alkaline & Zinc-Carbon Batteries')">Alkaline &amp; Zinc‑Carbon Batteries</button>
          <button class="big-btn" id="chooseLead" style="background:linear-gradient(135deg,#2d9cdb,#00c2a8)" onclick="playIrisSequence('Lead-containing Batteries')">Lead‑containing Batteries</button>
          <button class="big-btn danger" id="chooseReject" onclick="handleReject()">Not accepted here</button>
          <button class="big-btn danger" id="chooseFail" onclick="showScreen('rescan')">Scan unsuccessful – try again</button>
        </div>
      </section>

      <!-- RESULT: ACCEPTED -->
      <section id="accepted" class="screen center" hidden aria-label="Accepted">
        <div class="result-icon ok" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="40" height="40"><path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
        </div>
        <h1>Battery accepted!</h1>
        <p class="lead">Type <span id="typeAccepted">A</span> recognized. Thank you for recycling!</p>
        <div class="row">
          <button class="ghost-btn" id="againOk" onclick="showScreen('welcome')">Recycle another battery</button>
          <button class="outline-btn" id="finishOk" onclick="finishSession()">Finish</button>
        </div>
      </section>

      <!-- RESULT: REJECTED -->
      <section id="rejected" class="screen center" hidden aria-label="Rejected">
        <div class="result-icon no" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="40" height="40"><path fill="currentColor" d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm4.3 13.9-1.4 1.4L12 13.4l-2.9 2.9-1.4-1.4 2.9-2.9-2.9-2.9 1.4-1.4 2.9 2.9 2.9-2.9 1.4 1.4-2.9 2.9 2.9 2.9z"/></svg>
        </div>
        <h1>Not accepted here</h1>
        <p class="lead" id="rejectedMsg">Please refer to a staff member for help to redirect to a safe disposal site that accept this type of battery.</p>
        <div class="row">
          <button class="ghost-btn" id="againNo" onclick="showScreen('welcome')">Try another battery</button>
          <button class="outline-btn" id="finishNo" onclick="finishSession()">Finish</button>
        </div>
      </section>

      <!-- COMPLETION -->
      <section id="done" class="screen center" hidden aria-label="Completed">
        <h1 style="font-size:2.2rem; font-weight:800; color:#023047; margin-bottom:14px;">
          Great job!
        </h1>
      
        <p class="lead" style="max-width:60ch; margin:0 auto 10px; line-height:1.6; font-size:1.05rem;">
          Thank you for your contribution to safer e-waste handling. <br>
          By recycling batteries properly, we reduce fire risks <br>
          and prevent toxic metals from entering our environment.
        </p>
      
        <p class="lead" style="max-width:60ch; margin:10px auto 20px; line-height:1.6; font-size:1.05rem;">
          So far today, this collection point has safely processed
          <strong style="color:#0f7f4c;"><span id="countFinal">0</span></strong> batteries. <br>
          <strong style="color:#0f367f;">Every single one helps.</strong>
        </p>
      
        <div class="row" style="margin-top:22px;">
          <button class="ghost-btn" id="backHome" style="background:#e9fbf4; color:#0f7f4c; font-weight:600;" onclick="showScreen('welcome')">
            Back to Start
          </button>
        </div>
      </section>

      <!-- RESCAN HELP -->
      <section id="rescan" class="screen center" hidden aria-label="Rescan Help">
        <h1>Scan unsuccessful</h1>
        <p class="lead">Please adjust the angle or lighting, and ensure the label is in the frame.</p>
        <div class="row">
          <button class="ghost-btn" id="retryScan" onclick="openCamera()">Try Again</button>
          <button class="outline-btn" id="backWelcome" onclick="showScreen('welcome')">Back</button>
        </div>
      </section>

      <!-- IRIS SECTION (embedded in main flow, not a modal) -->
      <section id="iris" class="screen center" hidden aria-label="Deposit Battery">
        <h1>Deposit your battery</h1>
        <p class="lead">Please place the battery in the opening</p>
        <div class="irisWrap" id="irisWrap">
          <div class="blade"></div>
          <div class="blade"></div>
          <div class="blade"></div>
          <div class="blade"></div>
          <div class="blade"></div>
          <div class="blade"></div>
        </div>
      </section>
    </main>

    <!-- SENSOR DISPLAY BOX -->
    <div class="sensor-box">
      <div class="sensor-item">
        <div class="sensor-icon temp">🌡️</div>
        <div class="sensor-info">
          <span class="sensor-label">Temperature</span>
          <div>
            <span class="sensor-value" id="tempValue">--</span>
            <span class="sensor-unit">°C</span>
          </div>
        </div>
      </div>
      <div class="sensor-item">
        <div class="sensor-icon distance">📏</div>
        <div class="sensor-info">
          <span class="sensor-label">Bin Capacity</span>
          <div>
            <span class="sensor-value" id="distanceValue">--</span>
          </div>
        </div>
      </div>
    </div>

    <footer>
      Designed for the City of Melbourne e-waste management initiative. <br> 
      Developed by ENGR90051 Group 3-J.
    </footer>
  </div>

  <!-- CAMERA / SCAN INSTRUCTION MODAL -->
  <div class="modal" id="cameraModal" role="dialog" aria-modal="true" aria-label="Camera Scan">
    <div class="sheet">
      <div class="scanframe" aria-hidden="true">
        <div class="scanner"></div>
      </div>
      <h3>Point your camera at the battery</h3>
      <p>On a phone, the camera opens to scan the label. This demo simulates the scan.</p>
      <div class="row">
        <button class="big-btn" id="startScan" onclick="startScanProcess()">Start Scan</button>
      </div>
    </div>
  </div>

  <!-- BIN FULL MODAL -->
  <div class="modal" id="binFullModal" role="dialog" aria-modal="true" aria-label="Bin Full">
    <div class="sheet">
      <div class="result-icon no" aria-hidden="true" style="margin: 0 auto 16px;">
        <svg viewBox="0 0 24 24" width="40" height="40">
          <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
      </div>
      <h3 style="color: #e74c3c; margin-bottom: 12px;">Bin Currently Full</h3>
      <p style="font-size: 16px; line-height: 1.5;">The battery bin is currently full. Please come back later once the bin has been emptied.</p>
      <div class="row" style="margin-top: 20px;">
        <button class="big-btn" onclick="closeBinFullModal()" style="background: linear-gradient(135deg, #e74c3c, #ff6b6b);">OK</button>
      </div>
    </div>
  </div>

  <script>
    // Global state - stored in memory instead of localStorage
    var batteryCount = 0;
    var selectedBatteryType = null;
    var isBinFull = false;

    // UI Elements
    var countEl = document.getElementById('count');
    var countFinal = document.getElementById('countFinal');
    var typeAccepted = document.getElementById('typeAccepted');
    var rejectedMsg = document.getElementById('rejectedMsg');
    var cameraModal = document.getElementById('cameraModal');
    var binFullModal = document.getElementById('binFullModal');
    var irisWrap = document.getElementById('irisWrap');
    var tempValue = document.getElementById('tempValue');
    var distanceValue = document.getElementById('distanceValue');

    // Screen management
    function showScreen(screenId) {
      var screens = ['welcome', 'detect', 'choose', 'iris', 'accepted', 'rejected', 'rescan', 'done'];
      for (var i = 0; i < screens.length; i++) {
        var screen = document.getElementById(screens[i]);
        if (screen) {
          screen.classList.remove('active');
          screen.hidden = true;
        }
      }
      var targetScreen = document.getElementById(screenId);
      if (targetScreen) {
        targetScreen.hidden = false;
        targetScreen.classList.add('active');
      }
    }

    // Counter functions
    function updateCounters() {
      if (countEl) countEl.textContent = batteryCount;
      if (countFinal) countFinal.textContent = batteryCount;
    }

    function incrementCount() {
      batteryCount++;
      updateCounters();
    }

    // Modal functions
    function openCamera() {
      // Check if bin is full before opening camera
      if (isBinFull) {
        openBinFullModal();
        return;
      }
      
      if (cameraModal) {
        cameraModal.classList.add('open');
      }
    }

    function closeCamera() {
      if (cameraModal) {
        cameraModal.classList.remove('open');
      }
    }

    function openBinFullModal() {
      if (binFullModal) {
        binFullModal.classList.add('open');
      }
    }

    function closeBinFullModal() {
      if (binFullModal) {
        binFullModal.classList.remove('open');
      }
      // Return to welcome screen
      showScreen('welcome');
    }

    // Servo control functions
    function openServo() {
      fetch('/open', {method: 'POST'})
        .then(function(response) { return response.text(); })
        .then(function(data) { console.log('Servo opened:', data); })
        .catch(function(error) { console.error('Error opening servo:', error); });
    }

    function closeServo() {
      fetch('/close', {method: 'POST'})
        .then(function(response) { return response.text(); })
        .then(function(data) { console.log('Servo closed:', data); })
        .catch(function(error) { console.error('Error closing servo:', error); });
    }

    function playIrisSequence(typeLabel) {
      selectedBatteryType = typeLabel;
      
      // Show iris screen
      showScreen('iris');
      
      // Open iris animation AND servo after 300ms
      setTimeout(function() {
        if (irisWrap) {
          irisWrap.classList.add('open');
        }
        // Trigger servo to open
        openServo();
      }, 300);
      
      // Close iris animation AND servo after 5 seconds (5000ms from open start)
      setTimeout(function() {
        if (irisWrap) {
          irisWrap.classList.remove('open');
        }
        // Trigger servo to close
        closeServo();
      }, 5300);
      
      // Proceed to accepted screen after iris closes (wait for close animation)
      setTimeout(function() {
        if (typeAccepted) {
          typeAccepted.textContent = selectedBatteryType || 'Battery';
        }
        showScreen('accepted');
        incrementCount();
      }, 6200);
    }

    // Process functions
    function startScanProcess() {
      closeCamera();
      showScreen('detect');
      var delay = 1500 + Math.random() * 1200;
      setTimeout(function() {
        showScreen('choose');
      }, delay);
    }

    function handleReject() {
      if (rejectedMsg) {
        rejectedMsg.textContent = 'Please place the battery in the side bin. A staff member will handle it separately. Thank you for keeping everyone safe.';
      }
      showScreen('rejected');
      incrementCount();
    }

    function finishSession() {
      updateCounters();
      showScreen('done');
    }

    // Keyboard accessibility
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        if (cameraModal && cameraModal.classList.contains('open')) {
          closeCamera();
        }
        if (binFullModal && binFullModal.classList.contains('open')) {
          closeBinFullModal();
        }
      }
    });

    // Sensor data polling
    function updateSensorData() {
      fetch('/status')
        .then(function(response) { return response.json(); })
        .then(function(data) {
          if (tempValue && data.temp !== undefined) {
            tempValue.textContent = data.temp.toFixed(1);
          }
          if (distanceValue && data.capacity !== undefined) {
            // Display capacity as text (FULL or OK)
            distanceValue.textContent = data.capacity;
            
            // Update bin full status
            isBinFull = (data.capacity === 'FULL');
            
            // Change color based on status
            if (data.capacity === 'FULL') {
              distanceValue.style.color = '#e74c3c'; // Red for full
            } else {
              distanceValue.style.color = '#27ae60'; // Green for OK
            }
          }
        })
        .catch(function(error) {
          console.error('Error fetching sensor data:', error);
        });
    }

    // Update sensors every 2 seconds
    setInterval(updateSensorData, 2000);
    // Initial update
    updateSensorData();

    // Initialize counters on load
    updateCounters();
  </script>
</body>
</html>
